{
  "$defs": {
    "Producer": {
      "additionalProperties": false,
      "description": "Producer metadata.",
      "properties": {
        "build": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Build identifier",
          "title": "Build"
        },
        "name": {
          "description": "Producer name (required, non-empty)",
          "title": "Name",
          "type": "string"
        },
        "version": {
          "description": "Producer version (semver)",
          "title": "Version",
          "type": "string"
        }
      },
      "required": [
        "name",
        "version"
      ],
      "title": "Producer",
      "type": "object"
    },
    "Run": {
      "additionalProperties": false,
      "description": "Run metadata.",
      "properties": {
        "actor": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Actor",
          "title": "Actor"
        },
        "ref": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Git ref",
          "title": "Ref"
        },
        "run_attempt": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Run attempt",
          "title": "Run Attempt"
        },
        "run_id": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Run ID",
          "title": "Run Id"
        },
        "sha": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Commit SHA",
          "title": "Sha"
        },
        "workflow": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Workflow name",
          "title": "Workflow"
        }
      },
      "title": "Run",
      "type": "object"
    },
    "Source": {
      "additionalProperties": false,
      "description": "Source metadata.",
      "properties": {
        "enterprise": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Enterprise name",
          "title": "Enterprise"
        },
        "organization": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Organization name",
          "title": "Organization"
        },
        "repositories": {
          "description": "Source repositories",
          "items": {
            "type": "string"
          },
          "title": "Repositories",
          "type": "array"
        },
        "systems": {
          "description": "Source systems (required, non-empty)",
          "items": {
            "type": "string"
          },
          "title": "Systems",
          "type": "array"
        }
      },
      "required": [
        "systems"
      ],
      "title": "Source",
      "type": "object"
    },
    "TraceStep": {
      "additionalProperties": false,
      "description": "Trace step in audit trail.",
      "properties": {
        "finished_at": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "ISO 8601 timestamp",
          "title": "Finished At"
        },
        "started_at": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "ISO 8601 timestamp",
          "title": "Started At"
        },
        "step": {
          "description": "Step name (e.g., 'collection', 'normalization')",
          "title": "Step",
          "type": "string"
        },
        "tool": {
          "description": "Tool name",
          "title": "Tool",
          "type": "string"
        },
        "tool_version": {
          "description": "Tool version (semver)",
          "title": "Tool Version",
          "type": "string"
        },
        "warnings": {
          "description": "List of warnings",
          "items": {
            "$ref": "#/$defs/Warning"
          },
          "title": "Warnings",
          "type": "array"
        }
      },
      "required": [
        "step",
        "tool",
        "tool_version"
      ],
      "title": "TraceStep",
      "type": "object"
    },
    "Warning": {
      "additionalProperties": false,
      "description": "Warning in trace step.",
      "properties": {
        "code": {
          "description": "Warning code (e.g., 'VERSION_MISMATCH')",
          "title": "Code",
          "type": "string"
        },
        "context": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Optional context (e.g., field path)",
          "title": "Context"
        },
        "message": {
          "description": "Human-readable message",
          "title": "Message",
          "type": "string"
        }
      },
      "required": [
        "code",
        "message"
      ],
      "title": "Warning",
      "type": "object"
    }
  },
  "additionalProperties": false,
  "description": "Audit Envelope v1.0.",
  "properties": {
    "extensions": {
      "additionalProperties": {
        "additionalProperties": true,
        "type": "object"
      },
      "description": "Namespaced extensions (optional)",
      "title": "Extensions",
      "type": "object"
    },
    "producer": {
      "$ref": "#/$defs/Producer",
      "description": "Producer metadata"
    },
    "run": {
      "$ref": "#/$defs/Run",
      "description": "Run metadata"
    },
    "schema_version": {
      "description": "Schema version (must be '1.0')",
      "title": "Schema Version",
      "type": "string"
    },
    "source": {
      "$ref": "#/$defs/Source",
      "description": "Source metadata"
    },
    "trace": {
      "description": "Trace steps",
      "items": {
        "$ref": "#/$defs/TraceStep"
      },
      "title": "Trace",
      "type": "array"
    }
  },
  "required": [
    "schema_version",
    "producer",
    "run",
    "source",
    "trace"
  ],
  "title": "AuditEnvelopeV1",
  "type": "object"
}
